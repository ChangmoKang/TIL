# 데이터베이스 정규화 (DB Normalization)

관계형 데이터베이스에서 **중복**을 최소화하게 데이터를 **구조화**하는 작업 + 각종 **이상 현상 방지**(삽입, 삭제, 갱신)

| id   | name | age  | hobby |
| ---- | ---- | ---- | ----- |
| 100  | KCM  | 29   | A     |
| 101  | KYJ  | 29   | B     |
| 102  | LCM  | 29   | B     |
| 103  | JSJ  | 31   | C     |
| 104  | KCM  | 29   | D     |

<center>Table 1. 학생들의 정보 테이블</center>

* 삽입: 새로운 사람의 hobby를 모른다면 hobby 칼럼에 NULL이 들어감
* 삭제: 만약 JSJ가 더 이상 C라는 hobby를 가지고 있지 않아 삭제할 경우 JSJ의 정보가 테이블에서 모두 지워짐
* 갱신: 만약 KCM의 나이가 변경된다면 여러 줄의 데이터를 갱신해야 함. 이로 인해 데이터의 불일치가 발생할 수 있음.



### Reference

* [wiki](https://en.wikipedia.org/wiki/Database_normalization)
* [YouTube](https://www.youtube.com/watch?v=RXQ1kZ_JHqg)
* [Blog 1](https://3months.tistory.com/193) [Blog 2](https://untitledtblog.tistory.com/128) [Blog 3](https://victorydntmd.tistory.com/132)



## 제 1정규화 (First Normal Form, 1NF)

### 모든 열과 행의 중복지점에는 *한 개의 값* 을 가진다

| 주문번호 | 주문일 | 회원ID | 회원명 | 회원등급 | 상품ID             | 단위            | 수량                | 단가                  |
| -------- | ------ | ------ | ------ | -------- | ------------------ | --------------- | ------------------- | --------------------- |
| 1        | 200501 | LEE    | 이*민  | 일반     | H3<br />J1<br />K1 | A<br />B<br />C | 20<br />320<br />16 | 256<br />654<br />325 |
| 2        | 200505 | KIM    | 김*준  | 우수     | A1                 | D               | 8                   | 242                   |
| 3        | 200511 | JO     | 조*직  | 일반     | H0<br />R3         | B<br />E        | 10<br />8           | 651<br />129          |

<center>Table 2. 제 1정규화를 만족하지 않는 테이블</center>


Table 2.에서 `상품ID`, `단위`, `수량`, `단가` 에서 한 개 이상의 값을 가지는 도메인이 존재하므로 아래와 같이 테이블을 나누어야 한다.



| *주문번호* | 주문일 | 회원ID | 회원명 | 회원등급 |
| ---------- | ------ | ------ | ------ | -------- |
| 1          | 200501 | LEE    | 이*민  | 일반     |
| 2          | 200505 | KIM    | 김*준  | 우수     |
| 3          | 200511 | JO     | 조*직  | 일반     |

<center>Table 3. 제 1정규화를 만족하는 주문과 회원에 관한 테이블</center>
| *주문번호* | *상품ID* | 단위 | 수량 | 단가 |
| ---------- | -------- | ---- | ---- | ---- |
| 1          | H3       | A    | 20   | 256  |
| 1          | J1       | B    | 320  | 654  |
| 1          | K1       | C    | 16   | 325  |
| 2          | A1       | D    | 8    | 242  |
| 2          | H0       | B    | 10   | 651  |
| 3          | R3       | E    | 8    | 129  |

<center>Table 4. 제 1정규화를 만족하는 주문상세와 상품에 관한 테이블</center>


## 제 2정규화 (Second Normal Form, 2NF)

### *부분 함수적 종속 제거* (키가 아닌 모든 속성들이 기본키에 완전 함수 종속)

Table 4.에서 기본 키가 `주문번호`와 `상품ID` 복합키로 이루어져 있다. `수량` 복합키에 완전 함수 종속이지만 `상품ID`가 `단위`와 `단가`를 결정하므로 부분 함수적 종속이 존재한다. 따라서, 아래와 같이 테이블을 분리하여야 한다.



| *주문번호* | 상품ID | 수량 |
| ---------- | ------ | ---- |
| 1          | H3     | 20   |
| 1          | J1     | 320  |
| 1          | K1     | 16   |
| 2          | A1     | 8    |
| 2          | H0     | 10   |
| 3          | R3     | 8    |

<center>Table 5. 제 2정규화를 만족하는 주문상세에 관한 테이블</center>
| *상품ID* | *단위* | 단가 |
| -------- | ------ | ---- |
| H3       | A      | 256  |
| J1       | B      | 654  |
| K1       | C      | 325  |
| A1       | D      | 242  |
| H0       | B      | 651  |
| R3       | E      | 129  |

<center>Table 6. 제 2정규화를 만족하는 상품에 관한 테이블</center>


## 제 3정규화 (Third Normal Form, 3NF)

### *이행적 함수 종속 제거* (키가 아닌 모든 속성들이 기본키에 이행적으로 함수종속되지 않아야 함)

Table 3.에서 기본 키가 `주문번호`이므로 자동으로 제 2정규화를 만족한다. 하지만 `주문번호`가 `회원ID`를 결정하고 `회원ID`가 `회원명`과 `회원등급`을 결정하기 때문에 `회원명`과 `회원등급`이 기본키에 이행적으로 함수 종속되어있다. 따라서, 아래와 같이 테이블을 나누어야 한다.




| *주문번호* | 회원ID | 주문일 |
| ---------- | ------ | ------ |
| 1          | LEE    | 200501 |
| 2          | KIM    | 200505 |
| 3          | JO     | 200511 |

<center>Table 7. 제 3정규화를 만족하는 주문에 관한 테이블</center>
| *회원ID* | 회원명 | 회원등급 |
| -------- | ------ | -------- |
| LEE      | 이*민  | 일반     |
| KIM      | 김*준  | 우수     |
| JO       | 조*직  | 일반     |

<center>Table 8. 제 3정규화를 만족하는 회원에 관한 테이블</center>



## 강한 제 3정규형 (Boyce-Codd Normal Form, BCNF)

### 릴레이션의 모든 결정자가 후보키인 릴레이션을 만족 

| *학번* | *과목명*     | 교수 |
| ------ | ------------ | ---- |
| 1      | 데이터베이스 | A1   |
| 1      | 자료구조     | A2   |
| 2      | 데이터베이스 | A1   |
| 2      | 자료구조     | A3   |
| 3      | 자료구조     | A3   |
| 3      | 데이터베이스 | A4   |

> 단, 각 교수는 한 과목만 강의할 수 있고, 각 과목은 여러 교수들에 의해 강의될 수 있다.

<center>Table 8. 제 3정규화를 만족하는 수강과목에 관한 테이블</center>

table 8.에서 기본 키가 `학번`과 `과목명`으로 이루어진 복합키이고 이행적 종속이 일어나지 않고 있기 때문에 제 3정규화를 만족한다. 하지만 조건으로 인해 `교수`가 `과목명`을 결정하게 되어 후보키가 아닌 `교수`가 결정자가 되기 때문에 테이블을 아래와 같이 나누어야 한다.



| *학번* | *교수* |
| ------ | ------ |
| 1      | A1     |
| 1      | A2     |
| 2      | A1     |
| 2      | A3     |
| 3      | A3     |
| 3      | A4     |

<center>Table 9. 학번과 교수에 관한 테이블</center>

| *교수* | 과목명       |
| ------ | ------------ |
| A1     | 데이터베이스 |
| A2     | 자료구조     |
| A3     | 자료구조     |
| A4     | 데이터베이스 |

<center>Table 10. 교수와 과목명에 관한 테이블</center>